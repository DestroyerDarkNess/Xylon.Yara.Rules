rule Exploit_Java_CVE_2011_3521_A_2147655630_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3521.A"
        threat_id = "2147655630"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3521"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_10_1 = "corba/se/impl/io/ValueHandlerImpl" ascii //weight: 10
        $x_1_2 = {bb 59 2a b7 4c bb 59 b7 4d 2b 2c 03 13 12 01 b6 c0 4e 2d b4 03 32 04 b5 2d b4 03 32 10 b5 2d b4 03 32 10 b5 2d b4 03 32 13 b5 2d b4 03 32 c0 3a 19 01 01 b6}  //weight: 1, accuracy: High
        $x_1_3 = {01 b6 00 08 c0 00 06 4e 2d b4 00 09 03 32 04 b5 00 0a 2d b4 00 09 03 32 10 15 b5 00 0b 2d b4 00 09 03 32 10 4a b5 00 0c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2011_3521_A_2147655723_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3521.gen!A"
        threat_id = "2147655723"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3521"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "30"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "org/omg/CORBA" ascii //weight: 5
        $x_5_2 = "java/io/Serializable" ascii //weight: 5
        $x_5_3 = "java/lang/Exception" ascii //weight: 5
        $x_5_4 = "java/lang/reflect/Field" ascii //weight: 5
        $x_2_5 = "InputStream" ascii //weight: 2
        $x_2_6 = "read_Object" ascii //weight: 2
        $x_2_7 = "read_TypeCode" ascii //weight: 2
        $x_2_8 = "read_string" ascii //weight: 2
        $x_4_9 = {b8 59 b3 a7 b2 12}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_5_*) and 1 of ($x_4_*) and 3 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2011_3521_A_2147655724_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3521.A!ldr"
        threat_id = "2147655724"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3521"
        severity = "Critical"
        info = "ldr: loader component of a malware"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "28"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/io/FileOutputStream" ascii //weight: 5
        $x_5_2 = "java/io/InputStream" ascii //weight: 5
        $x_5_3 = "java/lang/String" ascii //weight: 5
        $x_5_4 = "java/lang/System" ascii //weight: 5
        $x_2_5 = "getResourceAsStream" ascii //weight: 2
        $x_2_6 = ".tmp" ascii //weight: 2
        $x_2_7 = "getRuntime" ascii //weight: 2
        $x_4_8 = {19 15 5c 33 19 15 07 70 2e 82 91}  //weight: 4, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_5_*) and 1 of ($x_4_*) and 2 of ($x_2_*))) or
            (all of ($x*))
        )
}


rule Exploit_Java_CVE_2012_3213_A_2147679129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-3213.A"
        threat_id = "2147679129"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-3213"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "35"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/applet/Applet" ascii //weight: 5
        $x_5_2 = "javax/script/ScriptEngine" ascii //weight: 5
        $x_5_3 = "sun/swing/SwingLazyValue" ascii //weight: 5
        $x_1_4 = "java/io/ByteArrayOutputStream" ascii //weight: 1
        $x_1_5 = "java/io/ObjectStreamClass" ascii //weight: 1
        $x_2_6 = "getResourceAsStream" ascii //weight: 2
        $x_2_7 = "toString" ascii //weight: 2
        $x_2_8 = "java/io/FileOutputStream" ascii //weight: 2
        $x_2_9 = "UIDefaults$LazyValue" ascii //weight: 2
        $x_2_10 = "sun.misc.Unsafe" ascii //weight: 2
        $x_1_11 = "JavaScript" ascii //weight: 1
        $x_1_12 = ".bin" ascii //weight: 1
        $x_10_13 = {bb 59 12 12 03 bd b7 01 b6 4d 2b 12 2c b9}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 3 of ($x_2_*) and 4 of ($x_1_*))) or
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 4 of ($x_2_*) and 2 of ($x_1_*))) or
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 5 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_3213_A_2147679130_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-3213.A!ldr"
        threat_id = "2147679130"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-3213"
        severity = "Critical"
        info = "ldr: loader component of a malware"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "34"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/io/InputStream" ascii //weight: 5
        $x_5_2 = "java/lang/String" ascii //weight: 5
        $x_5_3 = "java/lang/System" ascii //weight: 5
        $x_5_4 = "java/lang/Runtime" ascii //weight: 5
        $x_1_5 = "getResourceAsStream" ascii //weight: 1
        $x_1_6 = "cmd.exe /C" ascii //weight: 1
        $x_1_7 = "/bin/sh" ascii //weight: 1
        $x_1_8 = "os.name" ascii //weight: 1
        $x_10_9 = {13 12 b6 3a 19 c6 2d 19 b6}  //weight: 10, accuracy: High
        $x_1_10 = "TEMP" ascii //weight: 1
        $x_2_11 = "WINDOWS" ascii //weight: 2
        $x_1_12 = "file_drop" ascii //weight: 1
        $x_1_13 = "file_exec" ascii //weight: 1
        $x_10_14 = {b8 06 bd 59 03 12 53 59 04 12 53 59 05 2d b6 53 b6}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 1 of ($x_2_*) and 7 of ($x_1_*))) or
            ((1 of ($x_10_*) and 4 of ($x_5_*) and 4 of ($x_1_*))) or
            ((1 of ($x_10_*) and 4 of ($x_5_*) and 1 of ($x_2_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*) and 1 of ($x_5_*) and 1 of ($x_2_*) and 7 of ($x_1_*))) or
            ((2 of ($x_10_*) and 2 of ($x_5_*) and 4 of ($x_1_*))) or
            ((2 of ($x_10_*) and 2 of ($x_5_*) and 1 of ($x_2_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*) and 3 of ($x_5_*))) or
            (all of ($x*))
        )
}


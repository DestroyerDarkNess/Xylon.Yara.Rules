rule Exploit_Java_CVE_2012_0507_A_2147654933_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.A"
        threat_id = "2147654933"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0b 28 4c 61 2f 48 65 6c 70 3b 29}  //weight: 1, accuracy: High
        $x_1_2 = {06 61 2f 54 65 73 74}  //weight: 1, accuracy: High
        $x_1_3 = "0java/util/concurrent/atomic/AtomicReferenceArray" ascii //weight: 1
        $x_2_4 = {c0 3a 19 04 32 c0 3a 2a b6 b6 3a 19 03}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_B_2147654942_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.B"
        threat_id = "2147654942"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "CAFEBABE" ascii //weight: 1
        $x_1_2 = {06 61 2e 54 69 6d 65}  //weight: 1, accuracy: High
        $x_1_3 = {0b 28 4c 61 2f 48 65 6c 70 3b 29}  //weight: 1, accuracy: High
        $x_1_4 = {3a 05 19 05 b6 00 ?? c0 00 ?? 3a 09}  //weight: 1, accuracy: Low
        $x_2_5 = {be 19 b6 3a 19 b6 c0 3a a7 4c b1}  //weight: 2, accuracy: High
        $x_1_6 = {10 b8 07 78 2a 1c 04 60 b6 10 b8 60 91 54 84 a7}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_1_*))) or
            ((1 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_C_2147655224_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.C"
        threat_id = "2147655224"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/atomic/AtomicReferenceArray" ascii //weight: 1
        $x_1_2 = "getClassLoader" ascii //weight: 1
        $x_1_3 = "Ljavax/swing/JList" ascii //weight: 1
        $x_1_4 = "java/io/ByteArrayInputStream" ascii //weight: 1
        $x_1_5 = "Ljava/lang/StringBuilder" ascii //weight: 1
        $x_1_6 = "@2c54611566baa9f687cf8ffbba82c4c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_D_2147655233_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.D"
        threat_id = "2147655233"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "40"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/applet/Applet" ascii //weight: 5
        $x_5_2 = "java/lang/Exception" ascii //weight: 5
        $x_5_3 = "java/io/ObjectInputStream" ascii //weight: 5
        $x_5_4 = "java/util/concurrent/atomic/AtomicReferenceArray" ascii //weight: 5
        $x_4_5 = "ClassLoader" ascii //weight: 4
        $x_4_6 = "getClass" ascii //weight: 4
        $x_4_7 = "StringBuilder.toString" ascii //weight: 4
        $x_20_8 = {19 03 19 b6 19 03 32}  //weight: 20, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_20_*) and 2 of ($x_5_*) and 3 of ($x_4_*))) or
            ((1 of ($x_20_*) and 3 of ($x_5_*) and 2 of ($x_4_*))) or
            ((1 of ($x_20_*) and 4 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_D_2147655409_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.D!ldr"
        threat_id = "2147655409"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        info = "ldr: loader component of a malware"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "34"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = "java/security/cert/Certificate" ascii //weight: 5
        $x_5_2 = "java/security/Permissions" ascii //weight: 5
        $x_5_3 = "java/security/ProtectionDomain" ascii //weight: 5
        $x_5_4 = "java/security/AllPermission" ascii //weight: 5
        $x_4_5 = {73 65 63 75 72 69 74 79 ?? 43 6f 64 65 53 6f 75 72 63 65}  //weight: 4, accuracy: Low
        $x_4_6 = {72 65 66 6c 65 63 74 ?? 43 6f 6e 73 74 72 75 63 74 6f 72}  //weight: 4, accuracy: Low
        $x_1_7 = "net/URL" ascii //weight: 1
        $x_1_8 = "newInstance" ascii //weight: 1
        $x_10_9 = {2a b6 05 6c bc 4c 03 3d}  //weight: 10, accuracy: High
        $x_10_10 = {19 b7 3a 2a 12 ?? 03 ?? be 19 b6 3a}  //weight: 10, accuracy: Low
        $x_4_11 = "java/lang/ClassLoader" ascii //weight: 4
        $n_30_12 = "/security/provider/Policy" ascii //weight: -30
        $n_30_13 = "JETPolicy] JETPolicy : ext dir :" ascii //weight: -30
    condition:
        (filesize < 20MB) and
        (not (any of ($n*))) and
        (
            ((4 of ($x_5_*) and 3 of ($x_4_*) and 2 of ($x_1_*))) or
            ((1 of ($x_10_*) and 2 of ($x_5_*) and 3 of ($x_4_*) and 2 of ($x_1_*))) or
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 2 of ($x_4_*) and 1 of ($x_1_*))) or
            ((1 of ($x_10_*) and 3 of ($x_5_*) and 3 of ($x_4_*))) or
            ((1 of ($x_10_*) and 4 of ($x_5_*) and 1 of ($x_4_*))) or
            ((2 of ($x_10_*) and 3 of ($x_4_*) and 2 of ($x_1_*))) or
            ((2 of ($x_10_*) and 1 of ($x_5_*) and 2 of ($x_4_*) and 1 of ($x_1_*))) or
            ((2 of ($x_10_*) and 1 of ($x_5_*) and 3 of ($x_4_*))) or
            ((2 of ($x_10_*) and 2 of ($x_5_*) and 1 of ($x_4_*))) or
            ((2 of ($x_10_*) and 3 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_G_2147655579_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.G"
        threat_id = "2147655579"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "/atomic/AtomicReferenceArray" ascii //weight: 1
        $x_1_2 = "getClassLoader" ascii //weight: 1
        $x_1_3 = {b7 00 08 3a 18 12 ?? b6 00 ?? 3a 19 04 19 0f 03 19 19 b6 00 ?? bd 00 07 04 59 58 59 03}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_N_2147655737_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.N"
        threat_id = "2147655737"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {41 74 6f 6d 69 63 52 65 66 65 72 65 6e 63 65 41 72 72 61 79 [0-22] 67 65 74 43 6c 61 73 73 4c 6f 61 64 65 72}  //weight: 1, accuracy: Low
        $x_1_2 = "2E636F6E63757272656E742E61746F6D69632E41746F" ascii //weight: 1
        $x_1_3 = "6D69635265666572656E63654172726179" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_P_2147655877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.P"
        threat_id = "2147655877"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {0b 28 4c 61 2f 4d 73 67 73 3b 29}  //weight: 1, accuracy: High
        $x_1_2 = {06 61 2f 4d 73 67 73}  //weight: 1, accuracy: High
        $x_1_3 = "0java/util/concurrent/atomic/AtomicReferenceArray" ascii //weight: 1
        $x_2_4 = {c0 3a 19 04 32 c0 3a 2a b6 b6 3a 03 36 19 03}  //weight: 2, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_R_2147656023_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.R"
        threat_id = "2147656023"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "At00micArray.java" ascii //weight: 1
        $x_1_2 = "AC;;ED000;;;57572001" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_S_2147656124_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.S"
        threat_id = "2147656124"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "34"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/applet/Applet" ascii //weight: 5
        $x_5_2 = "java/lang/Exception" ascii //weight: 5
        $x_5_3 = "java/io/ObjectInputStream" ascii //weight: 5
        $x_5_4 = "java/util/concurrent/atomic/AtomicReferenceArray" ascii //weight: 5
        $x_4_5 = "ObjectStreamClass" ascii //weight: 4
        $x_4_6 = "AccessibleObject" ascii //weight: 4
        $x_4_7 = "SoftReference" ascii //weight: 4
        $x_6_8 = {03 b2 b6 b2 03 32 12 b8}  //weight: 6, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_6_*) and 4 of ($x_5_*) and 2 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_T_2147656141_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.T"
        threat_id = "2147656141"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "atomic/AtomicReferenceArray" ascii //weight: 1
        $x_1_2 = "ZKM4.2.4" ascii //weight: 1
        $x_1_3 = {2a 2b 04 32 c0 00 01 b5 00 02 2a b4 00 02 03 2c b6 00 03}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_S_2147656195_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.S!ldr"
        threat_id = "2147656195"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        info = "ldr: loader component of a malware"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "39"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/io/FileOutputStream" ascii //weight: 5
        $x_5_2 = "java/io/InputStream" ascii //weight: 5
        $x_5_3 = "java/lang/String" ascii //weight: 5
        $x_5_4 = "java/lang/System" ascii //weight: 5
        $x_5_5 = "java/lang/Runtime" ascii //weight: 5
        $x_2_6 = "getResourceAsStream" ascii //weight: 2
        $x_2_7 = "getClass" ascii //weight: 2
        $x_2_8 = "getRuntime" ascii //weight: 2
        $x_8_9 = {10 a7 10 a7 10 a7 05 a7 10 82 92 55 84 5f 5a 9a 5c 5f a7}  //weight: 8, accuracy: High
        $x_3_10 = "<key>StartInterval" ascii //weight: 3
        $x_3_11 = "<key>RunAtLoad</key>" ascii //weight: 3
        $x_3_12 = "/Library/Little Snitch" ascii //weight: 3
        $x_3_13 = "/Library/Caches/Java/cache" ascii //weight: 3
    condition:
        (filesize < 20MB) and
        (
            ((5 of ($x_5_*) and 3 of ($x_3_*) and 3 of ($x_2_*))) or
            ((5 of ($x_5_*) and 4 of ($x_3_*) and 1 of ($x_2_*))) or
            ((1 of ($x_8_*) and 3 of ($x_5_*) and 4 of ($x_3_*) and 2 of ($x_2_*))) or
            ((1 of ($x_8_*) and 4 of ($x_5_*) and 2 of ($x_3_*) and 3 of ($x_2_*))) or
            ((1 of ($x_8_*) and 4 of ($x_5_*) and 3 of ($x_3_*) and 1 of ($x_2_*))) or
            ((1 of ($x_8_*) and 4 of ($x_5_*) and 4 of ($x_3_*))) or
            ((1 of ($x_8_*) and 5 of ($x_5_*) and 3 of ($x_2_*))) or
            ((1 of ($x_8_*) and 5 of ($x_5_*) and 1 of ($x_3_*) and 2 of ($x_2_*))) or
            ((1 of ($x_8_*) and 5 of ($x_5_*) and 2 of ($x_3_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_Z_2147656253_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.Z"
        threat_id = "2147656253"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "java/applet/Applet" ascii //weight: 5
        $x_5_2 = "java/security/ProtectionDomain" ascii //weight: 5
        $x_5_3 = "java/util/concurrent/atomic/AtomicReferenceArray" ascii //weight: 5
        $x_4_4 = "StringBuilder" ascii //weight: 4
        $x_4_5 = "toHexString" ascii //weight: 4
        $x_5_6 = {32 b6 57 a7 bf 84 15 2d be a1 2a}  //weight: 5, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_5_*) and 1 of ($x_4_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2012_0507_AY_2147656772_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.AY"
        threat_id = "2147656772"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {51 45 0d 7b 17 40 44 14 3c 15 1a 6a 0d 3a 1b 5d 48 2b 30 10 51 59 1c 3b 15 51 6a 0b 27 17 4d}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_NR_2147660070_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.NR"
        threat_id = "2147660070"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {b7 b7 3a 19 b6 c0 c0 3a 19 03 32 c0 c0 3a 19 04 32 c0 3a 19 03 2c b6 19 03 32 2b}  //weight: 1, accuracy: High
        $x_1_2 = {10 32 b8 4c 2b b2 10 32 b6 4d 2c 04 b6 2c 01 b6 b3 b2 b6 b2 10 32 04 bd 59 03 12 53 b6 4e 2d b2 04 bd 59 03 12 12 b6 53 b6}  //weight: 1, accuracy: High
        $x_1_3 = {3a 08 11 10 00 bc 08 3a 09 03 36 0a}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Exploit_Java_CVE_2012_0507_NQ_2147665247_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.NQ"
        threat_id = "2147665247"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {b6 3a 2a 03 32 19 19 03 19 be 19 b6 3a 19 05 bd 59 03 (12|13) 53 59 04 (12|13) 53 b6 3a}  //weight: 1, accuracy: Low
        $x_1_2 = {04 32 c0 3a 2b b6 3a 05 bd 59 03 03 b8 53 59}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2012_0507_BKD_2147675817_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2012-0507.BKD"
        threat_id = "2147675817"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2012-0507"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "1"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "bWljLkF0b21pY1JlZmVyZW5jZUFycmF5qdLeob5lYAwCAAFbAAVhcnJheXQAE1tMamF2YS9sYW5nL09iamVjdDt4cHEAfgAD" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}


rule Exploit_Java_CVE_2011_3544_AV_2147654261_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.AV"
        threat_id = "2147654261"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {2a b7 2a bb 59 b7 12 12 12 b6 b6 b5 b1}  //weight: 1, accuracy: High
        $x_1_2 = {2a b4 12 12 12 b6 b9 57 a7 4c b1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2011_3544_A_2147654402_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.gen!A"
        threat_id = "2147654402"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "12"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "J(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;" ascii //weight: 1
        $x_1_2 = "Ljava/lang/Boolean;" ascii //weight: 1
        $x_1_3 = "java/lang/StringBuilder" ascii //weight: 1
        $x_1_4 = "o(Ljava/lang/String;Ljava/lang/Object;Ljava/lang/String;[Ljava/lang/Class;[Ljava/lang/Object;)Ljava/lang/Object;" ascii //weight: 1
        $x_2_5 = "javax/script/ScriptEngineManager" ascii //weight: 2
        $x_3_6 = {03 04 59 58 b8 3a 03 04 59 58 b8 3a 04 04 59 58 bd 04 59 58 59 03 04 59 58 12 53 3a 03 04 59 58}  //weight: 3, accuracy: High
        $x_3_7 = {04 59 58 b8 3a 04 04 59 58 bd 04 59 58 59 03 04 59 58 12 53 3a 03 04 59 58 b8 3a 03 04 59 58 b8}  //weight: 3, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2011_3544_B_2147654407_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.gen!B"
        threat_id = "2147654407"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "14"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "()Ljava/lang/Runtime;" ascii //weight: 1
        $x_1_2 = "*(Ljava/awt/Component;)Ljava/awt/Component;" ascii //weight: 1
        $x_1_3 = "-(Ljava/lang/String;)Ljava/lang/StringBuilder;" ascii //weight: 1
        $x_1_4 = "9(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;" ascii //weight: 1
        $x_1_5 = "@(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method;" ascii //weight: 1
        $x_1_6 = "Ljava/io/InputStream;" ascii //weight: 1
        $x_1_7 = "forName" ascii //weight: 1
        $x_1_8 = "getMethod" ascii //weight: 1
        $x_1_9 = "getRuntime" ascii //weight: 1
        $x_1_10 = "java/applet/Applet" ascii //weight: 1
        $x_1_11 = "java/io/FileOutputStream" ascii //weight: 1
        $x_1_12 = "javax/script/Invocable" ascii //weight: 1
        $x_2_13 = "javax/script/ScriptEngine" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2011_3544_BU_2147654707_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.BU"
        threat_id = "2147654707"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {56 7b 57 09 7c 12 69 42 1a 6d 4c 6e 0f 3b 67 4e 73 51 1c 41 52 7d 48 06 61 08 00 fb 01 00 16 56}  //weight: 1, accuracy: High
        $x_1_2 = {4e 7f 46 1b 72 4e 29 13 48 29 4f 3a 03 4d 77 1e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2011_3544_2147654816_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.gen!osx"
        threat_id = "2147654816"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        info = "osx: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "24"
        strings_accuracy = "High"
    strings:
        $x_5_1 = "javax/swing/JList" ascii //weight: 5
        $x_5_2 = "java/applet/Applet" ascii //weight: 5
        $x_5_3 = "javax/script/ScriptException" ascii //weight: 5
        $x_5_4 = "javax/script/ScriptEngineManager" ascii //weight: 5
        $x_2_5 = "toString" ascii //weight: 2
        $x_2_6 = "setSecurityManager" ascii //weight: 2
        $x_2_7 = ".tmp" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_5_*) and 2 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2011_3544_2147654816_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.gen!osx"
        threat_id = "2147654816"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        info = "osx: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "11"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "javax/swing/JList" ascii //weight: 1
        $x_1_2 = "java/applet/Applet" ascii //weight: 1
        $x_1_3 = "javax/script/ScriptEngine" ascii //weight: 1
        $x_1_4 = "java/awt/Component;)Ljava/awt/Component;" ascii //weight: 1
        $x_1_5 = "java/io/ByteArrayOutputStream" ascii //weight: 1
        $x_1_6 = "java/util/zip/Inflater" ascii //weight: 1
        $x_1_7 = "java/util/zip/DataFormatException" ascii //weight: 1
        $x_1_8 = "getResourceAsStream" ascii //weight: 1
        $x_2_9 = "java/io/FileOutputStream" ascii //weight: 2
        $x_2_10 = "java/io/InputStream" ascii //weight: 2
        $x_1_11 = "ldr_data" ascii //weight: 1
        $x_1_12 = "dropfile" ascii //weight: 1
        $x_1_13 = "saveFile" ascii //weight: 1
        $x_1_14 = "/tmp/" ascii //weight: 1
        $x_1_15 = "chmod" ascii //weight: 1
        $x_1_16 = "proxy" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((11 of ($x_1_*))) or
            ((1 of ($x_2_*) and 9 of ($x_1_*))) or
            ((2 of ($x_2_*) and 7 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2011_3544_C_2147654919_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.gen!C"
        threat_id = "2147654919"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "13"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "javax/script/ScriptEngineManager" ascii //weight: 1
        $x_1_2 = "javax/swing/JList" ascii //weight: 1
        $x_1_3 = "java/util/Random" ascii //weight: 1
        $x_1_4 = "openConnection" ascii //weight: 1
        $x_1_5 = "Ljava/net/URLConnection" ascii //weight: 1
        $x_1_6 = "write" ascii //weight: 1
        $x_1_7 = "toString" ascii //weight: 1
        $x_1_8 = "java/lang/Exception" ascii //weight: 1
        $x_1_9 = "java/io/FileOutputStream" ascii //weight: 1
        $x_1_10 = "substring" ascii //weight: 1
        $x_1_11 = "Ljava/lang/Runtime" ascii //weight: 1
        $x_1_12 = "exec" ascii //weight: 1
        $x_1_13 = "getEngineByName" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2011_3544_CF_2147654967_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2011-3544.CF"
        threat_id = "2147654967"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2011-3544"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "java.lang.System.setSecurityManager(null); applet.callBack();" ascii //weight: 1
        $x_1_2 = "javax/script/ScriptEngineManager" ascii //weight: 1
        $x_1_3 = "getEngineByName" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}


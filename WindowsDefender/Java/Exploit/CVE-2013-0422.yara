rule Exploit_Java_CVE_2013_0422_2147678620_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2013-0422"
        threat_id = "2147678620"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2013-0422"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "23"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = "java/io/ByteArrayOutputStream" ascii //weight: 5
        $x_5_2 = "javax/management/MBeanServer" ascii //weight: 5
        $x_5_3 = "java/lang/ClassLoader" ascii //weight: 5
        $x_2_4 = "newClass" ascii //weight: 2
        $x_2_5 = {54 65 6d 70 [0-16] 6f 70 65 6e}  //weight: 2, accuracy: Low
        $x_2_6 = {54 65 6d 70 [0-16] 65 78 65 70 75 74}  //weight: 2, accuracy: Low
        $x_2_7 = "botr444zano5" ascii //weight: 2
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Java_CVE_2013_0422_2147678620_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2013-0422"
        threat_id = "2147678620"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2013-0422"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "30"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = "java/io/FileOutputStream" ascii //weight: 5
        $x_5_2 = "java/lang/reflect/Method" ascii //weight: 5
        $x_5_3 = "java/nio/channels/FileChannel" ascii //weight: 5
        $x_5_4 = "java/lang/Runtime" ascii //weight: 5
        $x_2_5 = {72 65 66 6c 65 63 74 ?? 43 6f 6e 73 74 72 75 63 74 6f 72}  //weight: 2, accuracy: Low
        $x_2_6 = {43 6f 6e 73 74 72 75 63 74 6f 72 [0-16] 6e 65 77 49 6e 73 74 61 6e 63 65}  //weight: 2, accuracy: Low
        $x_2_7 = {2e 70 68 70 [0-16] 3f 77 68 6f 6c 65 3d}  //weight: 2, accuracy: Low
        $x_2_8 = "getRuntime" ascii //weight: 2
        $x_1_9 = ".tmp" ascii //weight: 1
        $x_1_10 = "/temp/" ascii //weight: 1
        $x_1_11 = "http://" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((4 of ($x_5_*) and 4 of ($x_2_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2013_0422_2147678620_2
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2013-0422"
        threat_id = "2147678620"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2013-0422"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "25"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = "java/lang/invoke/MethodHandles$Lookup" ascii //weight: 5
        $x_5_2 = "java/lang/invoke/MethodType" ascii //weight: 5
        $x_5_3 = "java/lang/ClassLoader" ascii //weight: 5
        $x_2_4 = {54 65 6d 70 [0-16] 65 78 65 70 75 74}  //weight: 2, accuracy: Low
        $x_2_5 = "localMethodHandle" ascii //weight: 2
        $x_1_6 = "publicLookup" ascii //weight: 1
        $x_1_7 = "findVirtual" ascii //weight: 1
        $x_1_8 = "localClass1" ascii //weight: 1
        $x_1_9 = "localMethodType1" ascii //weight: 1
        $x_2_10 = "botr444zano5" ascii //weight: 2
        $x_2_11 = ".tmp" ascii //weight: 2
        $x_2_12 = "/temp/" ascii //weight: 2
        $x_1_13 = "http://" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (
            ((2 of ($x_5_*) and 5 of ($x_2_*) and 5 of ($x_1_*))) or
            ((3 of ($x_5_*) and 3 of ($x_2_*) and 4 of ($x_1_*))) or
            ((3 of ($x_5_*) and 4 of ($x_2_*) and 2 of ($x_1_*))) or
            ((3 of ($x_5_*) and 5 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Exploit_Java_CVE_2013_0422_A_2147678637_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Java/CVE-2013-0422.A"
        threat_id = "2147678637"
        type = "Exploit"
        platform = "Java: Java binaries (classes)"
        family = "CVE-2013-0422"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_JAVAHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {53 b6 c0 3a 19 06 bd 59 03 19 53 59 04 01 53 59 05 03 02 01 01 b2 b8 2a 19 53 b6 c0 3a 19 b6 57 ((06|2d) b8 a7|b1)}  //weight: 10, accuracy: Low
        $x_1_2 = {bb 59 b7 4c 2b 12 01 01 b6 c0 4d 2c b6 4e 01 3a 2d 12 19 b6 3a 2d 12 19 b6 3a b8 3a 13}  //weight: 1, accuracy: High
        $x_1_3 = {bb 59 b7 3a 19 12 01 01 b6 c0 3a 19 b6 3a 01 3a 19 12 b8 19 b6 3a 19 12 b8 19 b6 3a b8 3a 12}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (
            ((1 of ($x_10_*) and 1 of ($x_1_*))) or
            (all of ($x*))
        )
}


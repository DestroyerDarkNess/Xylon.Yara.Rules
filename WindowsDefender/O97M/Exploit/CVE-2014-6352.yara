rule Exploit_O97M_CVE_2014_6352_SA_2147743271_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2014-6352.SA!MSR"
        threat_id = "2147743271"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2014-6352"
        severity = "Critical"
        info = "MSR: Microsoft Security Response"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "97B34601-5B4A-40AF-8963-D8C75594998B" ascii //weight: 1
        $x_1_2 = {3d 20 55 73 65 72 46 6f 72 6d 32 2e 54 65 78 74 42 6f 78 32 2e 54 61 67 20 2b 20 22 5c 7b [0-36] 7d 20 2d 20 [0-2] 2e 64 6c 6c}  //weight: 1, accuracy: Low
        $x_1_3 = {4b 69 6c 6c 41 72 72 61 79 20 5a 69 70 46 6f 6c 64 65 72 20 26 20 22 5c [0-7] 22 20 2b 20 22 [0-7] 2e 62 69 6e 22 2c 20 5a 69 70 4e 61 6d 65}  //weight: 1, accuracy: Low
        $x_1_4 = {3d 20 55 73 65 72 46 6f 72 6d 32 2e 54 65 78 74 42 6f 78 31 2e 54 61 67 20 26 20 22 5c [0-6] 2e 78 6c 73 78 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}


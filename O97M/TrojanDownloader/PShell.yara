rule TrojanDownloader_O97M_Pshell_GG_2147745132_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:O97M/Pshell.GG!MTB"
        threat_id = "2147745132"
        type = "TrojanDownloader"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "Pshell"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"cmd \" & \"/c\" & \"Powe" ascii //weight: 1
        $x_1_2 = {2e 00 53 00 68 00 65 00 6c 00 6c 00 45 00 78 00 65 00 63 00 75 00 74 00 65 00 20 00 22 00 63 00 6d 00 64 00 2e 00 65 00 78 00 65 00 20 00 22 00 2c 00 20 00 22 00 2f 00 63 00 20 00 22 00 20 00 26 00 20 00 22 00 20 00 22 00 20 00 26 00 20 00 [0-25] 2c 00 20 00 22 00 22 00 2c 00}  //weight: 1, accuracy: Low
        $x_1_3 = {2e 53 68 65 6c 6c 45 78 65 63 75 74 65 20 22 63 6d 64 2e 65 78 65 20 22 2c 20 22 2f 63 20 22 20 26 20 22 20 22 20 26 20 [0-25] 2c 20 22 22 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {56 00 42 00 41 00 2e 00 43 00 6f 00 6d 00 6d 00 61 00 6e 00 64 00 28 00 [0-25] 2c 00 20 00 52 00 69 00 67 00 68 00 74 00 28 00 52 00 69 00 67 00 68 00 74 00 28 00 4d 00 69 00 64 00 28 00 22 00 [0-80] 22 00 2c 00 [0-15] 29 00 2c 00 [0-15] 29 00 2c 00 [0-15] 29 00 29 00}  //weight: 1, accuracy: Low
        $x_1_5 = {56 42 41 2e 43 6f 6d 6d 61 6e 64 28 [0-25] 2c 20 52 69 67 68 74 28 52 69 67 68 74 28 4d 69 64 28 22 [0-80] 22 2c [0-15] 29 2c [0-15] 29 2c [0-15] 29 29}  //weight: 1, accuracy: Low
        $x_1_6 = {53 00 79 00 73 00 74 00 65 00 6d 00 2e 00 4e 00 65 00 74 00 2e 00 57 00 65 00 62 00 43 00 6c 00 69 00 65 00 6e 00 74 00 3b 00 24 00 63 00 6c 00 69 00 65 00 6e 00 74 00 2e 00 44 00 6f 00 77 00 6e 00 6c 00 6f 00 61 00 64 00 46 00 69 00 6c 00 65 00 28 00 27 00 68 00 74 00 74 00 70 00 [0-1] 3a 00 2f 00 2f 00 [0-30] 2f 00 [0-100] 2e 00 65 00 78 00 65 00 27 00 2c 00 27 00 22 00 20 00 26 00 20 00 22 00 25 00 22 00 20 00 26 00 20 00 22 00 74 00 65 00 6d 00 70 00 22 00 20 00 26 00 20 00 22 00 25 00 22 00 20 00 26 00 20 00 22 00 5c 00 [0-15] 2e 00 65 00 78 00 65 00 27 00 29 00}  //weight: 1, accuracy: Low
        $x_1_7 = {53 79 73 74 65 6d 2e 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 3b 24 63 6c 69 65 6e 74 2e 44 6f 77 6e 6c 6f 61 64 46 69 6c 65 28 27 68 74 74 70 [0-1] 3a 2f 2f [0-30] 2f [0-100] 2e 65 78 65 27 2c 27 22 20 26 20 22 25 22 20 26 20 22 74 65 6d 70 22 20 26 20 22 25 22 20 26 20 22 5c [0-15] 2e 65 78 65 27 29}  //weight: 1, accuracy: Low
        $x_1_8 = {3b 00 73 00 74 00 61 00 72 00 74 00 20 00 22 00 20 00 26 00 20 00 22 00 25 00 22 00 20 00 26 00 20 00 22 00 74 00 65 00 6d 00 70 00 22 00 20 00 26 00 20 00 22 00 25 00 22 00 20 00 26 00 20 00 22 00 5c 00 [0-15] 2e 00 65 00 78 00 65 00 22 00}  //weight: 1, accuracy: Low
        $x_1_9 = {3b 73 74 61 72 74 20 22 20 26 20 22 25 22 20 26 20 22 74 65 6d 70 22 20 26 20 22 25 22 20 26 20 22 5c [0-15] 2e 65 78 65 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (5 of ($x*))
}


rule Exploit_O97M_CVE_2017_11882_AR_2147750221_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AR!MTB"
        threat_id = "2147750221"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "= \"\"bin.base64\"\"\" & vbCrLf" ascii //weight: 1
        $x_1_2 = {3d 20 45 6e 76 69 72 6f 6e 28 22 54 65 6d 70 22 29 20 26 20 22 [0-32] 2e 76 62 73 22}  //weight: 1, accuracy: Low
        $x_1_3 = "ase64Decode(ByVal sBase64EncodedText, ByVal" ascii //weight: 1
        $x_1_4 = "Eval(obj)" ascii //weight: 1
        $x_1_5 = "% APPDATA %" ascii //weight: 1
        $x_1_6 = "s = s &" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CR_2147751832_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CR!MTB"
        threat_id = "2147751832"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"vrh5kryyj4kiwq6ui = \"\"kk\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"e\"\"\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AJ_2147753018_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AJ!MTB"
        threat_id = "2147753018"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {73 20 3d 20 73 20 2b 20 22 69 74 79 70 65 20 3d 20 22 22 62 69 6e 22 [0-48] 20 2b 20 76 62 43 72 4c 66}  //weight: 1, accuracy: Low
        $x_1_2 = {73 20 3d 20 73 20 2b 20 22 6a 75 73 74 5f 6f 62 6a 2e 65 78 65 63 20 52 55 4e 43 22 20 2b 20 76 62 43 72 4c 66 [0-21] 4f 6e 20 45 72 72 6f 72 20 52 65 73 75 6d 65 20 4e 65 78 74}  //weight: 1, accuracy: Low
        $x_1_3 = "Sub tse64Decode(ByVal sBase64EncodedText," ascii //weight: 1
        $x_1_4 = "strFile = objFSO.BuildPath( myPath, Mid( myURL, InStrRev( myURL, \"\"/\"\" )" ascii //weight: 1
        $x_1_5 = "x = x + \"\\asc.txt\"" ascii //weight: 1
        $x_1_6 = "File = File + \"vbs\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AD_2147753960_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AD!MTB"
        threat_id = "2147753960"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "9"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 73 20 3d 20 73 20 2b}  //weight: 1, accuracy: Low
        $x_1_2 = "s = s + \"itype = \"\"bin" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 53 75 62 20 74 73 65 36 34 44 65 63 6f 64 65 28 42 79 56 61 6c 20 73 42 61 73 65 36 34 45 6e 63 6f 64 65 64 54 65 78 74 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 20 20 20 20 44 69 6d 20 73 54 65 78 74 45 6e 63 6f 64 69 6e 67}  //weight: 1, accuracy: Low
        $x_1_5 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 20 20 20 20 45 78 65 63 75 74 65 28}  //weight: 1, accuracy: Low
        $x_1_6 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 63 61 6c 6c 20 61 73 65 36 34 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_7 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 53 75 62 20 48 54 78 54 50 44 6f 77 6e 6c 6f 61 64}  //weight: 1, accuracy: Low
        $x_1_8 = {2b 20 76 62 43 72 4c 66 02 00 73 20 3d 20 73 20 2b 20 22 20 20 20 70 61 74 68 20 3d 20 70 61 74 68 20 2b 20 22 22 5c 61 73 63 2e 74 78 74}  //weight: 1, accuracy: Low
        $x_1_9 = ".BuildPath( myPath, Mid( myURL, InStrRev( myURL," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AE_2147754181_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AE!MTB"
        threat_id = "2147754181"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b}  //weight: 1, accuracy: Low
        $x_1_2 = "varstrlong = varstrlong + \"itype = \"\"bin" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 53 75 62 20 61 73 65 36 34 44 65 63 6f 64 65 28 62 61 63 65 36 34 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 63 61 6c 6c 20 74 73 65 36 34 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_5 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 63 61 6c 6c 20 61 73 65 36 34 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
        $x_1_6 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 53 75 62 20 48 54 78 54 50 44 6f 77 6e 6c 6f 61 64}  //weight: 1, accuracy: Low
        $x_1_7 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 20 20 20 70 61 74 68 20 3d 20 70 61 74 68 20 2b 20 22 22 5c 61 73 63 2e 74 78 74}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AF_2147754641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AF!MTB"
        threat_id = "2147754641"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 66 73 64 66 64 73 66 73}  //weight: 1, accuracy: Low
        $x_1_2 = "varstrlong = varstrlong + \"fsdfdsfs" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 53 75 62 20 74 73 65 36 34 44 65 63 6f 64 65 28 62 61 63 65 36 34 2c}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b [0-48] 61 73 63 2e 74 78 74 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AFM_2147754822_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AFM!MTB"
        threat_id = "2147754822"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 66 73 64 66 64 73 66 73}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 63 61 6c 6c 20 74 73 65 36 34 44 65 63 6f 64 65 28 66 73 64 66 64 73 66 73 2c 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 53 75 62 20 48 54 78 54 50 44 6f 77 6e 6c 6f 61 64 28}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 76 62 43 72 4c 66 02 00 76 61 72 73 74 72 6c 6f 6e 67 20 3d 20 76 61 72 73 74 72 6c 6f 6e 67 20 2b 20 22 45 78 65 63 75 74 65 28 22 22 48 54 78 54 50 44 6f 77 6e 6c 6f 61 64 20 66 73 64 66 64 73 66 73 2c}  //weight: 1, accuracy: Low
        $x_1_5 = "ElseIf objFSO.FolderExists" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AG_2147755062_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AG!MTB"
        threat_id = "2147755062"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 66 73 64 66 64 73 66 73 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 53 75 62 20 74 73 65 36 34 44 65 63 6f 64 65 28 62 61 63 65 36 34 2c 20 75 74 31 36 29 22 20 2b 20 76 62 43 72 4c 66}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 63 61 6c 6c 20 74 73 65 36 34 44 65 63 6f 64 65 28 66 73 64 66 64 73 66 73 2c 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
        $x_1_4 = {2b 20 76 62 43 72 4c 66 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 53 75 62 20 48 54 78 54 50 44 6f 77 6e 6c 6f 61 64 28}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_AH_2147755063_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.AH!MTB"
        threat_id = "2147755063"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "call tse64Decode(fsdfdsfs,False)" ascii //weight: 1
        $x_1_2 = "\"Sub tse64Decode(bace64, ut16)\" + vbCrLf" ascii //weight: 1
        $x_1_3 = "\"dim after, path\" + vbCrLf" ascii //weight: 1
        $x_1_4 = "alxmd.Text = bace64 \" + vbCrLf" ascii //weight: 1
        $x_1_5 = "Execute(\"\"byteArray = alxmd.\"\" + novarue)\" + vbCrLf" ascii //weight: 1
        $x_1_6 = "If (fso.FileExists(path)) Then \" + vbCrLf" ascii //weight: 1
        $x_1_7 = "ElseIf objFSO.FolderExists( Left( myPath, InStrRev( myPath," ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BD_2147755431_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BD!MTB"
        threat_id = "2147755431"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 6f 69 75 79 74 72 66 76 62 6e 6d 6b 69 75 79 74 72 66 64}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 63 61 6c 6c 20 74 73 65 36 34 44 65 63 6f 64 65 28 6f 69 75 79 74 72 66 76 62 6e 6d 6b 69 75 79 74 72 66 64 2c 46 61 6c 73 65 29}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 78 63 76 62 6e 6d 63 76 6e 6d 20 3d 20 78 63 76 62 6e 6d 63 76 6e 6d 20 2b 20 22 6f 69 75 79 74 72 66 76 62 6e 6d 6b 69 75 79 74 72 66 64}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BE_2147756339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BE!MTB"
        threat_id = "2147756339"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6e 39 34 30 34 37 34 6a 35 35 35 20 3d 20 6e 39 34 30 34 37 34 6a 35 35 35 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75}  //weight: 1, accuracy: Low
        $x_1_2 = {76 62 43 72 4c 66 02 00 6e 39 34 30 34 37 34 6a 35 35 35 20 3d 20 6e 39 34 30 34 37 34 6a 35 35 35 20 2b 20 22 76 67 75 67 66 63 66 67 79 67 66 63 66 67 79 67 66 63 66 79 74 66 66 79 67}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6e 39 34 30 34 37 34 6a 35 35 35 20 3d 20 6e 39 34 30 34 37 34 6a 35 35 35 20 2b 20 22 63 61 6c 6c 20 74 73 65 36 34 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BF_2147756616_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BF!MTB"
        threat_id = "2147756616"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 76 67 75 67 66 63 66 67 79 67 66 63 66 67 79 67 66 63 66 79 74 66 66 79 67}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 63 61 6c 6c 20 67 72 67 65 72 67 72 65 32 38 75 33 38 6b 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BG_2147756805_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BG!MTB"
        threat_id = "2147756805"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34}  //weight: 1, accuracy: Low
        $x_1_2 = {76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 76 67 75 67 66 63 66 67 79 67 66 63 66 67 79 67 66 63 66 79 74 66 66 79 67}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 45 78 65 63 75 74 65 28 22 22 63 61 6c 6c 20 67 72 67 65 72 67 72 65 32 38 75 33 38 6b 44 65 63 6f 64 65}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BH_2147756974_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BH!MTB"
        threat_id = "2147756974"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 76 67 75 67 66 63 66 67 79 67 66 63 66 67 79 67 66 63 66 79 74 66 66 79 67}  //weight: 1, accuracy: Low
        $x_1_3 = "oojihugygftfdtftfgyhuytrtrdrfg34" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BI_2147757345_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BI!MTB"
        threat_id = "2147757345"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "Execute(\"\"strFile = objFSO.\"\" + \"\"Build\"\" +" ascii //weight: 1
        $x_1_2 = {45 78 65 63 75 74 65 28 22 22 66 73 6f 2e 44 65 6c 65 74 65 46 69 6c 65 28 70 61 74 68 29 22 22 29 20 27 [0-7] 22 20 2b 20 76 62 43 72 4c 66}  //weight: 1, accuracy: Low
        $x_1_3 = "myURL, False\"\")\" + vbCrLf" ascii //weight: 1
        $x_1_4 = "msg = path & \"\" doesn't exist.\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_5 = "Execute(\"\"baax.\"\" + \"\"Open\"\") \" + vbCrLf" ascii //weight: 1
        $x_1_6 = "path = path + \"\"\\program\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_7 = "x = x + \"\\asc.txt\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BJ_2147757486_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BJ!MTB"
        threat_id = "2147757486"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 20 20 20 20 6d 73 69 65 69 65 68 74 65 67 79 33 33 67 79}  //weight: 1, accuracy: Low
        $x_1_3 = "oojihugygftfdtftfgyhuytrtrdrfg34" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BL_2147757731_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BL!MTB"
        threat_id = "2147757731"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 3d 20 6c 64 6a 64 69 75 33 34 68 34 33 67 79 34 33 68 75 74 33 34 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BM_2147757732_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BM!MTB"
        threat_id = "2147757732"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "path = \"\"C\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_2 = "+ \"\"in\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_3 = "+ \"\"64\"\" \" + vbCrLf" ascii //weight: 1
        $x_1_4 = "path = path + \"\":\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_5 = "path = path + \"\"\\program\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_6 = "msg = path & \"\" doesn't exist.\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_7 = "Execute(\"\"strFile = objFSO.\"\" + \"\"Build\"\" +" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BN_2147758033_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BN!MTB"
        threat_id = "2147758033"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 70 77 63 64 79 67 74 79 33 75 33 75 39 69 39 77 65 33 20 3d 20 70 77 63 64 79 67 74 79 33 75 33 75 39 69 39 77 65 33 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 70 77 63 64 79 67 74 79 33 75 33 75 39 69 39 77 65 33 20 3d 20 70 77 63 64 79 67 74 79 33 75 33 75 39 69 39 77 65 33 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BO_2147758331_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BO!MTB"
        threat_id = "2147758331"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 3d 20 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 39 31 30 30 02 00 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 3d 20 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BP_2147758625_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BP!MTB"
        threat_id = "2147758625"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 3d 20 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 [0-16] 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 3d 20 7a 62 7a 6b 61 64 65 69 33 37 32 32 33 34 33 32 33 34 35 78 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BQ_2147758882_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BQ!MTB"
        threat_id = "2147758882"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 63 62 34 69 6a 65 75 72 20 3d 20 63 62 34 69 6a 65 75 72 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 [0-16] 63 62 34 69 6a 65 75 72 20 3d 20 63 62 34 69 6a 65 75 72 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "cb4ijeur = cb4ijeur +" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BR_2147758883_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BR!MTB"
        threat_id = "2147758883"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "oojihugygftfdtftfgyhuytrtrdrfg34 = \"" ascii //weight: 1
        $x_1_2 = "Application.Eval (bttttttttgggggggg4.Run(Path + TXTFile, yu67fre54kji, waitOnReturn))" ascii //weight: 1
        $x_1_3 = "bgfjeryhj57r6uj55jry6jr + \"\"64\"\" \" + vbCrLf '0000" ascii //weight: 1
        $x_1_4 = "cb4ijeur = cb4ijeur + \"Execute" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BS_2147759163_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BS!MTB"
        threat_id = "2147759163"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6a 65 6f 6a 72 76 62 73 6c 34 20 3d 20 6a 65 6f 6a 72 76 62 73 6c 34 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 [0-16] 6a 65 6f 6a 72 76 62 73 6c 34 20 3d 20 6a 65 6f 6a 72 76 62 73 6c 34 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BT_2147759473_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BT!MTB"
        threat_id = "2147759473"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "+ \"cft6ygvcr4rcvfgyu = \"\"" ascii //weight: 1
        $x_1_2 = "cft6ygvcr4rcvfgyu,False) \" + vbCrLf '0000" ascii //weight: 1
        $x_1_3 = {26 20 22 2e 70 64 66 22 02 00 4e 65 78 74 20 77 73 02 00 45 6e 64 20 53 75 62}  //weight: 1, accuracy: Low
        $x_1_4 = "= fso.File\"\" + \"\"Exists(path)\"\")\" + vbCrLf '0000" ascii //weight: 1
        $x_1_5 = "= objFSO\"\"\" + vbCrLf '0000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BU_2147759769_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BU!MTB"
        threat_id = "2147759769"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 73 69 75 6e 77 75 66 6a 73 66 74 77 32 20 3d 20 73 69 75 6e 77 75 66 6a 73 66 74 77 32 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 73 69 75 6e 77 75 66 6a 73 66 74 77 32 20 3d 20 73 69 75 6e 77 75 66 6a 73 66 74 77 32 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BV_2147759770_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BV!MTB"
        threat_id = "2147759770"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "+ \"cft6ygvcr4rcvfgyu = \"\"" ascii //weight: 1
        $x_1_2 = "(cft6ygvcr4rcvfgyu,False) \" + vbCrLf '0000" ascii //weight: 1
        $x_1_3 = "+ \"\"in\"\"\" + vbCrLf '0000" ascii //weight: 1
        $x_1_4 = "+ \"\"ba\"\"\" + vbCrLf '0000" ascii //weight: 1
        $x_1_5 = "+ \"\"se\"\"\" + vbCrLf '0000" ascii //weight: 1
        $x_1_6 = "+ \"\"64\"\" \" + vbCrLf '0000" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BW_2147760283_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BW!MTB"
        threat_id = "2147760283"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 72 6b 69 38 36 79 75 68 6a 68 6a 75 74 37 35 20 3d 20 72 6b 69 38 36 79 75 68 6a 68 6a 75 74 37 35 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 72 6b 69 38 36 79 75 68 6a 68 6a 75 74 37 35 20 3d 20 72 6b 69 38 36 79 75 68 6a 68 6a 75 74 37 35 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BX_2147760636_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BX!MTB"
        threat_id = "2147760636"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 63 79 74 77 6d 77 62 64 35 35 77 38 32 39 20 3d 20 63 79 74 77 6d 77 62 64 35 35 77 38 32 39 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 63 79 74 77 6d 77 62 64 35 35 77 38 32 39 20 3d 20 63 79 74 77 6d 77 62 64 35 35 77 38 32 39 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BY_2147761877_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BY!MTB"
        threat_id = "2147761877"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 75 79 74 72 67 64 79 36 35 32 74 33 79 68 65 67 64 74 75 20 3d 20 75 79 74 72 67 64 79 36 35 32 74 33 79 68 65 67 64 74 75 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 75 79 74 72 67 64 79 36 35 32 74 33 79 68 65 67 64 74 75 20 3d 20 75 79 74 72 67 64 79 36 35 32 74 33 79 68 65 67 64 74 75 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_BZ_2147762263_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.BZ!MTB"
        threat_id = "2147762263"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 68 66 34 67 32 37 65 33 39 34 74 68 33 37 32 33 6a 66 68 20 3d 20 68 66 34 67 32 37 65 33 39 34 74 68 33 37 32 33 6a 66 68 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 68 66 34 67 32 37 65 33 39 34 74 68 33 37 32 33 6a 66 68 20 3d 20 68 66 34 67 32 37 65 33 39 34 74 68 33 37 32 33 6a 66 68 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CA_2147762400_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CA!MTB"
        threat_id = "2147762400"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 6a 75 37 75 6a 74 72 35 34 72 66 6f 39 69 65 6b 33 69 65 38 20 3d 20 6a 75 37 75 6a 74 72 35 34 72 66 6f 39 69 65 6b 33 69 65 38 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 6a 75 37 75 6a 74 72 35 34 72 66 6f 39 69 65 6b 33 69 65 38 20 3d 20 6a 75 37 75 6a 74 72 35 34 72 66 6f 39 69 65 6b 33 69 65 38 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CB_2147762576_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CB!MTB"
        threat_id = "2147762576"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 69 75 37 38 38 34 65 67 33 65 72 35 32 33 74 72 36 67 20 3d 20 69 75 37 38 38 34 65 67 33 65 72 35 32 33 74 72 36 67 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 69 75 37 38 38 34 65 67 33 65 72 35 32 33 74 72 36 67 20 3d 20 69 75 37 38 38 34 65 67 33 65 72 35 32 33 74 72 36 67 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CC_2147762759_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CC!MTB"
        threat_id = "2147762759"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 48 52 44 54 59 45 55 33 37 36 34 33 79 20 3d 20 48 52 44 54 59 45 55 33 37 36 34 33 79 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 48 52 44 54 59 45 55 33 37 36 34 33 79 20 3d 20 48 52 44 54 59 45 55 33 37 36 34 33 79 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CD_2147763510_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CD!MTB"
        threat_id = "2147763510"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 54 59 4a 59 74 75 34 79 38 39 35 52 54 59 38 39 20 3d 20 54 59 4a 59 74 75 34 79 38 39 35 52 54 59 38 39 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 30 30 30 30 02 00 54 59 4a 59 74 75 34 79 38 39 35 52 54 59 38 39 20 3d 20 54 59 4a 59 74 75 34 79 38 39 35 52 54 59 38 39 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CE_2147763874_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CE!MTB"
        threat_id = "2147763874"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 75 72 6a 6b 64 65 37 33 65 33 67 79 37 34 74 33 20 3d 20 75 72 6a 6b 64 65 37 33 65 33 67 79 37 34 74 33 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 68 36 37 32 34 33 36 72 75 69 32 02 00 75 72 6a 6b 64 65 37 33 65 33 67 79 37 34 74 33 20 3d 20 75 72 6a 6b 64 65 37 33 65 33 67 79 37 34 74 33 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CF_2147763927_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CF!MTB"
        threat_id = "2147763927"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 68 69 68 67 6e 66 64 66 67 34 35 34 35 79 75 35 67 20 3d 20 68 69 68 67 6e 66 64 66 67 34 35 34 35 79 75 35 67 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 64 75 64 79 79 36 69 77 6e 62 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 37 37 34 35 79 6a 75 75 79 33 72 74 72 02 00 68 69 68 67 6e 66 64 66 67 34 35 34 35 79 75 35 67 20 3d 20 68 69 68 67 6e 66 64 66 67 34 35 34 35 79 75 35 67 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CG_2147764413_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CG!MTB"
        threat_id = "2147764413"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 72 75 65 72 75 72 69 77 65 72 75 77 79 75 66 67 64 20 3d 20 72 75 65 72 75 72 69 77 65 72 75 77 79 75 66 67 64 20 2b 20 22 22 20 2b 20 22 22 20 2b 20 22 62 76 66 67 73 74 64 79 74 79 75 33 72 66 35 33 33 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 37 37 34 35 79 6a 75 75 79 33 72 74 72 02 00 72 75 65 72 75 72 69 77 65 72 75 77 79 75 66 67 64 20 3d 20 72 75 65 72 75 72 69 77 65 72 75 77 79 75 66 67 64 20 2b}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CH_2147764690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CH!MTB"
        threat_id = "2147764690"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 64 38 68 32 78 20 3d 20 64 38 68 32 78 20 26 20 22 62 76 66 67 73 74 64 79 74 79 75 33 72 66 35 33 33}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 64 38 68 32 78 20 3d 20 64 38 68 32 78 20 26 20 22 62 76 66 67 73 74 64 79 74 79 75 33 72 66 35 33 33 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 22 22 73 65 36 22 22 22 20 2b 20 76 62 43 72 4c 66 02 00 64 38 68 32 78 20 3d 20 64 38 68 32 78 20 26}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CI_2147765311_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CI!MTB"
        threat_id = "2147765311"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 64 6d 69 38 76 67 37 38 65 72 33 20 3d 20 64 6d 69 38 76 67 37 38 65 72 33 20 26 20 22 62 76 66 67 73 74 64 79 74 79 75 33 72 66 35 33 33}  //weight: 1, accuracy: Low
        $x_1_2 = {76 62 43 72 4c 66 02 00 64 6d 69 38 76 67 37 38 65 72 33 20 3d 20 64 6d 69 38 76 67 37 38 65 72 33 20 26 20 22 62 76 66 67 73 74 64 79 74 79 75 33 72 66 35 33 33 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 22 22 73 65 36 22 22 22 20 2b 20 76 62 43 72 4c 66 02 00 64 6d 69 38 76 67 37 38 65 72 33}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CJ_2147766409_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CJ!MTB"
        threat_id = "2147766409"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 64 62 76 77 75 36 33 74 72 34 74 20 3d 20 64 62 76 77 75 36 33 74 72 34 74 20 26 20 22 69 6f 66 75 37 65 67 37 76 66 74 72 36 72 33 74 72 33 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 64 62 76 77 75 36 33 74 72 34 74 20 3d 20 64 62 76 77 75 36 33 74 72 34 74 20 26 20 22 69 6f 66 75 37 65 67 37 76 66 74 72 36 72 33 74 72 33 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"se6\"\"\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CK_2147767175_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CK!MTB"
        threat_id = "2147767175"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 70 70 73 64 79 66 72 35 32 33 68 72 68 34 33 20 3d 20 70 70 73 64 79 66 72 35 32 33 68 72 68 34 33 20 26 20 22 76 72 68 35 6b 72 79 79 6a 34 6b 69 77 71 36 75 69 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 4c 66 02 00 02 00 70 70 73 64 79 66 72 35 32 33 68 72 68 34 33 20 3d 20 70 70 73 64 79 66 72 35 32 33 68 72 68 34 33 20 26 20 22 76 72 68 35 6b 72 79 79 6a 34 6b 69 77 71 36 75 69 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"se6\"\"\" + vbLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CL_2147767458_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CL!MTB"
        threat_id = "2147767458"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 [0-32] 64 75 35 34 33 39 6d 65 6e 68 67 66 65 30 33 68 35 36 77 6d 65 6f 73 74 66 65 6a 64 66 73 77 70 66 36 34 6d 65 64 66 37 64 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = "kviobbvuivct6yibd = kviobbvuivct6yibd & \"vrh5kryyj4kiwq6ui = \"\"" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 4c 66 02 00 6b 76 69 6f 62 62 76 75 69 76 63 74 36 79 69 62 64 20 3d 20 6b 76 69 6f 62 62 76 75 69 76 63 74 36 79 69 62 64}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CM_2147767755_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CM!MTB"
        threat_id = "2147767755"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 [0-32] 64 75 35 34 33 39 6d 65 6e 68 67 66 65 30 33 68 35 36 77 6d 65 6f 73 74 66 65 6a 64 66 73 77 70 66 36 34 6d 65 64 66 37 64 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = "& \"vrh5kryyj4kiwq6ui = \"\"" ascii //weight: 1
        $x_1_3 = "& \"            du5439menhgfe03h56wmeostfejdfswpf64medf7d = \"\"" ascii //weight: 1
        $x_1_4 = "+ \"\"se6\"\"\" + vbLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CN_2147768073_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CN!MTB"
        threat_id = "2147768073"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 [0-32] 6b 76 6f 69 38 37 66 36 37 77 69 64 66 67 68 38 74 33 72 77 67 33 20 3d}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 4c 66 02 00 6c 73 64 74 66 6a 74 63 65 64 66 67 68 73 6a 64 66 20 3d 20 6c 73 64 74 66 6a 74 63 65 64 66 67 68 73 6a 64 66 20 26 20 22 76 72 68 35 6b 72 79 79 6a 34 6b 69 77 71 36 75 69 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "kvoi87f67widfgh8t3rwg3 = \"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CO_2147770085_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CO!MTB"
        threat_id = "2147770085"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 73 64 66 64 66 20 3d 20 73 64 66 64 66 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 39 31 30 31 34 34 02 00 73 64 66 64 66 20 3d 20 73 64 66 64 66 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"in\"\"\" + vbCrLf '910112" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CP_2147770339_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CP!MTB"
        threat_id = "2147770339"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 73 64 66 73 64 66 20 3d 20 73 64 66 73 64 66 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_2 = {2b 20 76 62 43 72 4c 66 20 27 [0-16] 73 64 66 73 64 66 20 3d 20 73 64 66 73 64 66 20 2b 20 22 63 66 74 36 79 67 76 63 72 34 72 63 76 66 67 79 75 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"ba\"\"\" + vbCrLf '" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CNG_2147771153_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CNG!MTB"
        threat_id = "2147771153"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 44 69 6d 20 63 6e 67 66 6a 6d 64 65 74 74 74 67 64 65 6a 74 6a 65 74 68 74 28 32 30 30 29 20 41 73 20 53 74 72 69 6e 67}  //weight: 1, accuracy: Low
        $x_1_2 = "cngfjmdetttgdejtjetht(3) = \"eGYIOCJIhGJEOGcIOCJacFJaP = p\"" ascii //weight: 1
        $x_1_3 = "cngfjmdetttgdejtjetht(35) = \"" ascii //weight: 1
        $x_1_4 = "= CreateProcessA(0&, cmdline$, 0&, 0&, 1&, _" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MUT_2147771946_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MUT!MTB"
        threat_id = "2147771946"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"vrh5kryyj4kiwq6ui = \"\"" ascii //weight: 1
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22 76 72 68 35 6b 72 79 79 6a 34 6b 69 77 71 36 75 69 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22 62 67 66 6a 65 72 79 68 6a 35 37 72 36 75 6a 35 35 6a 72 79 36 6a 72 20 3d 20 22 22}  //weight: 1, accuracy: Low
        $x_1_4 = "+ \"\"ase\"\"\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_CQ_2147773598_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.CQ!MTB"
        threat_id = "2147773598"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"vrh5kryyj4kiwq6ui = \"\"kk\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_2 = "mu38swif2 = mu38swif2 & \"vrh5kryyj4kiwq6ui = \"\"" ascii //weight: 1
        $x_1_3 = "+ \"\"4\"\"\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MUU_2147774198_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MUU!MTB"
        threat_id = "2147774198"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"" ascii //weight: 1
        $x_1_2 = "bgfjeryhj57r6uj55jry6jr = bgfjeryhj57r6uj55jry6jr + \"\"in.\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MUV_2147775627_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MUV!MTB"
        threat_id = "2147775627"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"            lifwjifwbyg8dsi9jf35hu4ifdg3yuie3" ascii //weight: 1
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_3 = "+ \"\"Docu\"\" + \"\"ment\"\"\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MUV_2147775627_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MUV!MTB"
        threat_id = "2147775627"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "mu38swif2 = mu38swif2 & \"vrh5kryyj4kiwq6ui = \"\"kk\"\"\" + vbCrLf" ascii //weight: 1
        $x_1_2 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_3 = "fnfgnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MVU_2147776913_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MVU!MTB"
        threat_id = "2147776913"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "BTDNACHOSIYTZJKAMKGGBUSOODMPRBZCZHM" ascii //weight: 1
        $x_1_2 = "mu38swif2 = mu38swif2 &" ascii //weight: 1
        $x_1_3 = {2b 20 76 62 43 72 4c 66 02 00 6d 75 33 38 73 77 69 66 32 20 3d 20 6d 75 33 38 73 77 69 66 32 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_4 = "= CStr(ieeeeeeeeehhhhhfgfg)\" + vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_O97M_CVE_2017_11882_MUZ_2147777440_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:O97M/CVE-2017-11882.MUZ!MTB"
        threat_id = "2147777440"
        type = "Exploit"
        platform = "O97M: Office 97, 2000, XP, 2003, 2007, and 2010 macros - those that affect Word, Excel, and PowerPoint"
        family = "CVE-2017-11882"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACROHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {53 75 62 20 41 75 74 6f 5f 4f 70 65 6e 28 29 02 00 4e 4b 4b 4d 4b 4c 4c 4f 47 5a 46 51 52 43 4e 48 51 4c 44 51 58 45 4d 5a 42 42 41 4d 44 57 51 57 50 49 4e 20 3d 20 22}  //weight: 1, accuracy: Low
        $x_1_2 = "sjwuthe53 = sjwuthe53 & \"" ascii //weight: 1
        $x_1_3 = {26 20 76 62 43 72 4c 66 02 00 73 6a 77 75 74 68 65 35 33 20 3d 20 73 6a 77 75 74 68 65 35 33 20 26 20 22}  //weight: 1, accuracy: Low
        $x_1_4 = "= ShxllExxcute(0, \"open\"," ascii //weight: 1
        $x_1_5 = "+ \"\"x\"\"\" & vbCrLf" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

